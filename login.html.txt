<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Smart HSR - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
<link rel="icon" type="image/svg+xml" href="favicon.svg"> 

<link rel="stylesheet" href="output.css">

<style>
  /* ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ø®Ø· ÙˆØªØºÙŠÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ØªÙƒÙˆÙ† Ø£ÙØªØ­ */
  body{
    margin:0;
    font-family: 'Tajawal', sans-serif;
    background: linear-gradient(180deg,#f7f9fb 0%, #ffffff 100%);
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:30px;
  }

  .card{
    width: 380px;
    background:#ffffff;
    border-radius:16px;
    box-shadow: 0 12px 30px rgba(10,20,50,0.09);
    padding:26px;
    position:relative;
    overflow:hidden;
    text-align: right; /* Ù„Ø¶Ù…Ø§Ù† Ù…Ø­Ø§Ø°Ø§Ø© ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ù„ÙŠÙ…ÙŠÙ† */
  }
  .card:before{
    content:"";
    position:absolute;
    left:-40px;
    top:-40px;
    width:100px;
    height:100px;
    background-color: var(--color-teal); /* Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØºÙŠØ±Ø§Øª Tailwind Ø§Ù„Ù…Ø®ØµØµØ© */
    border-radius:50%;
    opacity:0.6;
  }

  .card h2{
    text-align: center;
    font-size: 24px;
    font-weight: 700;
    color: #333;
    margin-bottom: 25px;
  }
  
  .form-group{
    margin-bottom:18px;
  }

  .form-group label{
    display:block;
    font-size:14px;
    color:#555;
    margin-bottom:6px;
    font-weight: 500;
  }
  
  .form-group input{
    width:100%;
    padding:12px;
    border:1px solid #ddd;
    border-radius:8px;
    font-size:16px;
    transition:border-color 0.3s;
    font-family: 'Tajawal', sans-serif;
  }

  .form-group input:focus{
    outline:none;
    border-color:var(--color-teal);
    box-shadow: 0 0 0 3px rgba(24, 165, 162, 0.2);
  }

  .btn{
    width:100%;
    padding:12px;
    background-color:var(--color-teal);
    color:white;
    border:none;
    border-radius:8px;
    font-size:18px;
    font-weight:700;
    cursor:pointer;
    transition:background-color 0.3s, transform 0.1s;
  }

  .btn:hover{
    background-color:#148e8b;
  }

  .btn:active{
    transform:scale(0.99);
  }

  .message{
    padding:10px;
    margin-bottom:15px;
    border-radius:8px;
    font-size:14px;
    font-weight: 500;
    text-align: center;
  }

  .message.success{
    background-color:#d4edda;
    color:#155724;
    border: 1px solid #c3e6cb;
  }

  .message.error{
    background-color:#f8d7da;
    color:#721c24;
    border: 1px solid #f5c6cb;
  }

  .resend-link {
    display: block;
    text-align: center;
    margin-top: 15px;
    font-size: 14px;
    color: var(--color-teal);
    cursor: pointer;
    text-decoration: none;
  }
  .resend-link:hover {
    text-decoration: underline;
  }
  #recaptcha-container {
      margin-top: 15px;
      text-align: center;
  }
</style>
</head>
<body>

<div class="card">
  <div class="flex justify-center mb-6">
    <svg width="40" height="40" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
      <rect width="64" height="64" rx="12" fill="#18A5A2"/>
      <text x="32" y="45" font-family="Arial, sans-serif" font-size="36" font-weight="bold" text-anchor="middle" fill="white">HSR</text>
    </svg>
  </div>
  
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Smart HSR</h2>

  <div id="message-area" class="message hidden"></div>

  <div id="phone-section">
    <div class="form-group">
      <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (Ø¨Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ© +966xxxxxxxx)</label>
      <input type="tel" id="phone" placeholder="+9665xxxxxxxx" required>
    </div>
    <button id="send-otp-btn" class="btn" onclick="sendOTP()">Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</button>
  </div>
  
  <div id="recaptcha-container"></div>
  
  <div id="otp-section" style="display: none;">
    <div class="form-group">
      <label for="otp-code">Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ (OTP)</label>
      <input type="text" id="otp-code" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…" required maxlength="6">
    </div>
    <button id="verify-otp-btn" class="btn" onclick="verifyOTP()">ØªØ£ÙƒÙŠØ¯ ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    <p class="text-center mt-3 text-sm text-gray-500">
        <span onclick="resendOTP()" class="resend-link">Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø²</span>
    </p>
    <p class="text-center mt-3 text-sm text-gray-500">
        <span onclick="clearPhone()" class="resend-link">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ù‚Ù…</span>
    </p>
  </div>

  <p class="text-center mt-6 text-sm text-gray-400">
      Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; 2024 Smart HSR
  </p>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script>
  // **********************************************
  // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
  // **ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø±Ø³Ù„ ÙˆØªØ¶Ù…ÙŠÙ† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆÙ‡Ù…ÙŠØ© ÙƒØ§Ù…Ù„Ø©**
  // **********************************************
  const firebaseConfig = {
      apiKey: "AIzaSyC5HTAq-LeJn4GObn08REwKdqIeokKmwds", // ğŸ”‘ ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù‡Ù†Ø§
      authDomain: "smarthsr-dashboard.firebaseapp.com", 
      projectId: "smarthsr-dashboard", 
      storageBucket: "smarthsr-dashboard.appspot.com", 
      messagingSenderId: "1234567890", 
      appId: "1:1234567890:web:abcdef123456" 
  };

  // Initialize Firebase
  if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
  }
  const auth = firebase.auth();
  
  let confirmationResultGlobal = null;
  let lastPhoneUsed = null;

  // **********************************************
  // 2. Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
  // **********************************************

  function msg(text, type = '') {
      const msgArea = document.getElementById('message-area');
      msgArea.textContent = text;
      msgArea.className = 'message';
      if (text) {
          msgArea.classList.remove('hidden');
          if (type) {
              msgArea.classList.add(type);
          }
      } else {
          msgArea.classList.add('hidden');
      }
  }

  // **********************************************
  // 3. Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
  // **********************************************
  
  // ØªÙ‡ÙŠØ¦Ø© reCAPTCHA Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
  window.onload = function() {
      // Ù†Ø³ØªØ®Ø¯Ù… reCAPTCHA ØºÙŠØ± Ù…Ø±Ø¦ÙŠ Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
      window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', { 
          'size': 'invisible',
          'callback': (response) => {
              // reCAPTCHA ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡
          }
      });
      // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† reCAPTCHA Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ø±Ø¶ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø±Ø¦ÙŠØ§Ù‹ØŒ Ø£Ùˆ ØªÙ… ØªÙ†ÙÙŠØ°Ù‡ Ø¥Ø°Ø§ ÙƒØ§Ù† ØºÙŠØ± Ù…Ø±Ø¦ÙŠ
      recaptchaVerifier.render().then((widgetId) => {
          // ÙŠÙ…ÙƒÙ† Ù‡Ù†Ø§ Ø£Ù† Ù†Ø¬Ø¹Ù„Ù‡ Ù…Ø±Ø¦ÙŠØ§Ù‹: document.getElementById('recaptcha-container').style.display = 'block';
      });

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
      auth.onAuthStateChanged((user) => {
          if (user) {
               // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ù‡ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ø£Ø¹ÙØ¯ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
               window.location.href = 'index.html';
          }
      });
  };


  function sendOTP() {
    const phoneNumber = document.getElementById('phone').value.trim();
    if (!phoneNumber) {
      msg('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
      return;
    }

    lastPhoneUsed = phoneNumber;
    msg('Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚...', '');
    
    // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† reCAPTCHA Ù‚Ø¯ ØªÙ… ØªÙ‡ÙŠØ¦ØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­
    if (!window.recaptchaVerifier) {
         msg('Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© reCAPTCHA. Ø­Ø§ÙˆÙ„ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.', 'error');
         return;
    }

    auth.signInWithPhoneNumber(phoneNumber, window.recaptchaVerifier)
      .then((confirmationResult) => {
        confirmationResultGlobal = confirmationResult;
        document.getElementById('phone-section').style.display = 'none';
        document.getElementById('otp-section').style.display = 'block';
        msg('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰ ' + phoneNumber, 'success');
      }).catch((err) => {
        msg(err.message || 'ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø². ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø±Ù‚Ù….', 'error');
        // ÙÙŠ Ø­Ø§Ù„ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŒ Ù†Ø¹ÙŠØ¯ Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ø§Ù„Ù‡Ø§ØªÙ
        document.getElementById('phone-section').style.display = 'block';
        document.getElementById('otp-section').style.display = 'none';
      });
  }

  function verifyOTP() {
    const code = document.getElementById('otp-code').value.trim();
    if (!code) {
      msg('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚', 'error');
      return;
    }

    if (!confirmationResultGlobal) {
        msg('ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚. Ø­Ø§ÙˆÙ„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø² Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error');
        return;
    }
    
    msg('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù…Ø²...', '');

    confirmationResultGlobal.confirm(code)
      .then((result) => {
        const user = result.user;
        msg('ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        
        // **Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¶Ø±ÙˆØ±ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø£Ù† ØµÙØ­Ø© index.html Ù„Ø§ ØªÙØªØ­ Ù…Ø¨Ø§Ø´Ø±Ø©**
        localStorage.setItem('userIsLoggedIn', 'true');
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©
        setTimeout(() => {
            window.location.href = 'index.html';
        }, 1000); 

      })
      .catch((err) => {
        msg(err.message || 'Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
      });
  }

  function resendOTP(){
    // Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù†Ù‡ÙŠØ¦ reCAPTCHA Ù…Ù† Ø¬Ø¯ÙŠØ¯ Ø«Ù… Ù†Ø±Ø³Ù„ Ø¹Ù„Ù‰ Ø¢Ø®Ø± Ù‡Ø§ØªÙ
    if(!lastPhoneUsed){ msg('Ø£Ø±Ø³Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø£ÙˆÙ„Ø§Ù‹', 'error'); return; }
    // reset recaptcha
    window.recaptchaVerifier.clear();
    window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', { 'size': 'invisible' });
    msg('Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...', '');
    auth.signInWithPhoneNumber(lastPhoneUsed, window.recaptchaVerifier)
      .then((confirmationResult) => {
        confirmationResultGlobal = confirmationResult;
        msg('Ø£ÙØ¹ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚', 'success');
      }).catch((err)=>{
        msg(err.message || 'ÙØ´Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', 'error');
      });
  }

  function clearPhone(){
    document.getElementById('phone').value = '';
    document.getElementById('otp-code').value = '';
    document.getElementById('otp-section').style.display = 'none';
    document.getElementById('phone-section').style.display = 'block';
    msg('');
  }
</script>
</body>
</html>